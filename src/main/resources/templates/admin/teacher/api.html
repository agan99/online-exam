<script>
    //----------------------- 新增教师部分 -----------------------
    function goSave() {
        $("#saveModal").modal({show: true, backdrop: 'static'});
    }
    function saveTeacher() {
        OesUtil.confirm("确定增加教师吗?", function () {
            let data = $("#save-form").serialize() + "&roleId=3";

            $.post("/api/teacher/save/", data).done(function (data) {
                if (data.state === "success") {
                    OesUtil.closeModal("#saveModal");
                    $('#save-form')[0].reset();
                    OesUtil.refreshTable("#teacherInfo");
                } else {
                    toastr.error(data.message);
                }
            })
        })
    }

    //----------------------- 模糊查询部分 -----------------------
    function params(params) {
        return {
            current: params.pageNumber,
            size: params.pageSize,
            key: $("#findKey").val(),
        };
    }
    OesUtil.bindRequest('#findKey', '#teacherInfo', 200);

    // 操作栏
    function operateFormatter(value, row, index) {
        return ['  <button class="btn btn-success btn-sm" onclick="goUpdate(' + row.id
        + ')">编辑 </button>\n' + '  <button class="btn btn-sm btn-danger" onclick="deleteTeacher('
        + row.id + ') ">删除</button>\n'].join('');
    }

    // 初始化表格
    OesUtil.initQueryTable('#teacherInfo',
          "/api/teacher/list?academyId=" + "0", "get", [{
            title: '编号', field: 'id', sortable: false, formatter: function (value, row, index) {
              return index + 1;
            }
          }, {title: '姓名', field: 'name', sortable: false},
            {title: '工号', field: 'workNumber', sortable: false},
            {title: '职级', field: 'job', sortable: false}, {title: '性别', field: 'sex', sortable: false},
            {field: 'operate', title: '操作', formatter: operateFormatter}], params);





    // 打开编辑页面
    function goUpdate(id) {
        getTeacher(id);
        $("#updateModal").modal({show: true, backdrop: 'static'});
    }

    function getTeacher(id) {
        $.get("/api/teacher/" + id, function (data) {
            $('#id').val(data.id);
            $('#name').val(data.name);
            $('#workNumber').val(data.workNumber);
            $('#job').val(data.job).select2({width: "100%", theme: "bootstrap4"});
            $('#academyId').val(data.academyId).select2({theme: 'bootstrap4'});
            $('#sex').val(data.sex).select2({width: "100%", theme: "bootstrap4"});
            $("#sex option").each(function () {
                if ($(this).val() === data.sex) {
                    $(this).attr('selected', true);
                }
            })
        })
    }

    // 更新
    function updateTeacher() {
        OesUtil.confirm("确定修改信息吗?", function () {
            let data = $("#update-form").serialize();
            $.post("/api/teacher/update/", data).done(function (data) {
                if (data.state === "success") {
                    OesUtil.closeModal("#updateModal");
                    $('#update-form')[0].reset();
                    OesUtil.refreshTable("#teacherInfo");
                } else {
                    toastr.error(data.message);
                }
            })
        })
    }

    // 打开删除页面
    function deleteTeacher(id) {
        OesUtil.confirm("确定删除学教师吗?", function () {
            $.post("/api/teacher/delete/" + id).done(function (data) {
                if (data.state === "success") {
                    OesUtil.refreshTable("#teacherInfo");
                } else {
                    toastr.error(data.message);
                }
            })
        })
    }

    // 填充学院信息
    $.get("/api/academy").done(function (data) {
        let options = "";
        $('.academySelect').empty();
        $.each(data, function (index, e) {
            options += "<option value=" + e.id + ">" + e.name + "</option>";
        });
        $(".academySelect").append(options).val('').select2({theme: 'bootstrap4'});
    });

</script>